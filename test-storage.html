<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест localStorage</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 10px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Тест localStorage для системы анкетирования</h1>
    
    <div class="test-section">
        <h2>1. Проверка доступности localStorage</h2>
        <button onclick="checkLocalStorage()">Проверить localStorage</button>
        <div id="localStorage-status"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Тест сохранения анкеты</h2>
        <button onclick="saveTestSurvey()">Сохранить тестовую анкету</button>
        <div id="save-status"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Проверка загрузки анкет</h2>
        <button onclick="loadSurveys()">Загрузить анкеты</button>
        <div id="load-status"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Очистка данных</h2>
        <button onclick="clearData()">Очистить все данные</button>
        <div id="clear-status"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Просмотр всех данных localStorage</h2>
        <button onclick="showAllData()">Показать все данные</button>
        <pre id="all-data"></pre>
    </div>

    <script>
        function checkLocalStorage() {
            const status = document.getElementById('localStorage-status');
            try {
                if (typeof(Storage) !== "undefined") {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    status.innerHTML = '<span style="color: green;">✓ localStorage доступен</span>';
                } else {
                    status.innerHTML = '<span style="color: red;">✗ localStorage недоступен</span>';
                }
            } catch (e) {
                status.innerHTML = '<span style="color: red;">✗ Ошибка localStorage: ' + e.message + '</span>';
            }
        }
        
        function saveTestSurvey() {
            const status = document.getElementById('save-status');
            try {
                const testSurvey = {
                    id: Date.now().toString(),
                    title: "Тестовая анкета",
                    questions: [
                        {
                            id: "q0",
                            text: "Как дела?",
                            type: "text",
                            required: true,
                            options: [],
                            conditions: []
                        }
                    ],
                    createdAt: new Date().toISOString(),
                    isActive: true
                };
                
                const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
                surveys.push(testSurvey);
                localStorage.setItem('surveys', JSON.stringify(surveys));
                
                status.innerHTML = '<span style="color: green;">✓ Тестовая анкета сохранена</span>';
            } catch (e) {
                status.innerHTML = '<span style="color: red;">✗ Ошибка сохранения: ' + e.message + '</span>';
            }
        }
        
        function loadSurveys() {
            const status = document.getElementById('load-status');
            try {
                const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
                status.innerHTML = '<span style="color: green;">✓ Загружено анкет: ' + surveys.length + '</span>';
                status.innerHTML += '<pre>' + JSON.stringify(surveys, null, 2) + '</pre>';
            } catch (e) {
                status.innerHTML = '<span style="color: red;">✗ Ошибка загрузки: ' + e.message + '</span>';
            }
        }
        
        function clearData() {
            const status = document.getElementById('clear-status');
            try {
                localStorage.removeItem('surveys');
                localStorage.removeItem('responses');
                status.innerHTML = '<span style="color: green;">✓ Данные очищены</span>';
            } catch (e) {
                status.innerHTML = '<span style="color: red;">✗ Ошибка очистки: ' + e.message + '</span>';
            }
        }
        
        function showAllData() {
            const allData = document.getElementById('all-data');
            const data = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                data[key] = localStorage.getItem(key);
            }
            allData.textContent = JSON.stringify(data, null, 2);
        }
        
        // Автоматическая проверка при загрузке
        window.onload = function() {
            checkLocalStorage();
        };
    </script>
</body>
</html>


